# =============================================================================
# Agency Standard - OpenAPI Specification
# =============================================================================
# This file is auto-generated by scripts/update_context.py
# Run `just update-context` to regenerate
#
# Purpose: Provide AI coding assistants with API structure context
# =============================================================================

openapi: 3.1.0
info:
  title: Agency Standard
  description: A production-ready Python backend kit for software agencies
  version: 0.1.0
paths:
  /health/live:
    get:
      tags:
        - health
      summary: Liveness probe
      description: Kubernetes liveness probe. Returns 200 if the process is running.
      operationId: liveness_health_live_get
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"
  /health/ready:
    get:
      tags:
        - health
      summary: Readiness probe
      description: Kubernetes readiness probe. Checks database and cache connectivity.
      operationId: readiness_health_ready_get
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReadinessResponse"
  /info:
    get:
      tags:
        - health
      summary: Application info
      description: Returns application metadata.
      operationId: info_info_get
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                additionalProperties: true
                type: object
                title: Response Info Info Get
  /api/v1/auth/register:
    post:
      tags:
        - auth
      summary: Register new user and tenant
      description:
        Creates a new tenant and user account. The user becomes the tenant's
        superuser.
      operationId: register_api_v1_auth_register_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
        required: true
      responses:
        "201":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RegisterResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/auth/login:
    post:
      tags:
        - auth
      summary: Login with email and password
      description:
        Authenticate with email and password to receive access and refresh
        tokens.
      operationId: login_api_v1_auth_login_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
        required: true
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/auth/refresh:
    post:
      tags:
        - auth
      summary: Refresh access token
      description:
        Use a refresh token to obtain a new access token. The old refresh
        token is revoked.
      operationId: refresh_token_api_v1_auth_refresh_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
        required: true
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/auth/logout:
    post:
      tags:
        - auth
      summary: Logout
      description: Revoke the refresh token to logout from the current session.
      operationId: logout_api_v1_auth_logout_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RefreshTokenRequest"
        required: true
      responses:
        "204":
          description: Successful Response
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/auth/logout-all:
    post:
      tags:
        - auth
      summary: Logout from all devices
      description: Revoke all refresh tokens to logout from all devices.
      operationId: logout_all_api_v1_auth_logout_all_post
      responses:
        "204":
          description: Successful Response
      security:
        - HTTPBearer: []
  /api/v1/auth/me:
    get:
      tags:
        - auth
      summary: Get current user
      description: Returns the currently authenticated user's profile.
      operationId: get_me_api_v1_auth_me_get
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
      security:
        - HTTPBearer: []
  /api/v1/auth/oauth/providers:
    get:
      tags:
        - oauth
      summary: List OAuth providers
      description: Returns list of configured OAuth providers.
      operationId: list_providers_api_v1_auth_oauth_providers_get
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OAuthProvidersResponse"
  /api/v1/auth/oauth/{provider}/authorize:
    get:
      tags:
        - oauth
      summary: Get OAuth authorization URL
      description: Returns the URL to redirect the user to for OAuth authorization.
      operationId: authorize_api_v1_auth_oauth__provider__authorize_get
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            title: Provider
        - name: redirect_uri
          in: query
          required: false
          schema:
            anyOf:
              - type: string
              - type: "null"
            description: Custom redirect URI (defaults to callback endpoint)
            title: Redirect Uri
          description: Custom redirect URI (defaults to callback endpoint)
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OAuthAuthorizeResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/auth/oauth/{provider}/callback:
    get:
      tags:
        - oauth
      summary: OAuth callback
      description: Handle OAuth provider callback after authorization.
      operationId: oauth_callback_api_v1_auth_oauth__provider__callback_get
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            title: Provider
        - name: code
          in: query
          required: false
          schema:
            anyOf:
              - type: string
              - type: "null"
            description: Authorization code from provider
            title: Code
          description: Authorization code from provider
        - name: state
          in: query
          required: true
          schema:
            type: string
            description: State parameter for CSRF verification
            title: State
          description: State parameter for CSRF verification
        - name: error
          in: query
          required: false
          schema:
            anyOf:
              - type: string
              - type: "null"
            description: Error from provider
            title: Error
          description: Error from provider
        - name: error_description
          in: query
          required: false
          schema:
            anyOf:
              - type: string
              - type: "null"
            description: Error description
            title: Error Description
          description: Error description
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/users/me:
    get:
      tags:
        - users
      summary: Get current user
      description: Returns the currently authenticated user's profile.
      operationId: get_me_api_v1_users_me_get
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
      security:
        - HTTPBearer: []
    patch:
      tags:
        - users
      summary: Update current user
      description: Update the currently authenticated user's profile.
      operationId: update_me_api_v1_users_me_patch
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdate"
        required: true
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
      security:
        - HTTPBearer: []
  /api/v1/users:
    get:
      tags:
        - users
      summary: List users
      description: List all users in the current tenant. Requires admin permissions.
      operationId: list_users_api_v1_users_get
      security:
        - HTTPBearer: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            description: Page number
            default: 1
            title: Page
          description: Page number
        - name: page_size
          in: query
          required: false
          schema:
            type: integer
            maximum: 100
            minimum: 1
            description: Items per page
            default: 20
            title: Page Size
          description: Items per page
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserListResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/users/{user_id}:
    get:
      tags:
        - users
      summary: Get user by ID
      description: Get a specific user by their ID. Requires admin permissions.
      operationId: get_user_api_v1_users__user_id__get
      security:
        - HTTPBearer: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            title: User Id
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
    patch:
      tags:
        - users
      summary: Update user
      description: Update a user's profile. Requires admin permissions.
      operationId: update_user_api_v1_users__user_id__patch
      security:
        - HTTPBearer: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            title: User Id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdate"
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/users/{user_id}/deactivate:
    post:
      tags:
        - users
      summary: Deactivate user
      description: Deactivate a user account. Requires admin permissions.
      operationId: deactivate_user_api_v1_users__user_id__deactivate_post
      security:
        - HTTPBearer: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            title: User Id
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
  /api/v1/users/{user_id}/activate:
    post:
      tags:
        - users
      summary: Activate user
      description:
        Activate a previously deactivated user account. Requires admin
        permissions.
      operationId: activate_user_api_v1_users__user_id__activate_post
      security:
        - HTTPBearer: []
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
            title: User Id
      responses:
        "200":
          description: Successful Response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserResponse"
        "422":
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HTTPValidationError"
components:
  schemas:
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: "#/components/schemas/ValidationError"
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    HealthResponse:
      properties:
        status:
          type: string
          title: Status
      type: object
      required:
        - status
      title: HealthResponse
      description: Health check response schema.
    LoginRequest:
      properties:
        email:
          type: string
          format: email
          title: Email
        password:
          type: string
          title: Password
      type: object
      required:
        - email
        - password
      title: LoginRequest
      description: Schema for email/password login.
    OAuthAuthorizeResponse:
      properties:
        url:
          type: string
          title: Url
        state:
          type: string
          title: State
      type: object
      required:
        - url
        - state
      title: OAuthAuthorizeResponse
      description: Response with authorization URL.
    OAuthProvidersResponse:
      properties:
        providers:
          items:
            type: string
          type: array
          title: Providers
      type: object
      required:
        - providers
      title: OAuthProvidersResponse
      description: List of available OAuth providers.
    ReadinessResponse:
      properties:
        status:
          type: string
          title: Status
        checks:
          additionalProperties:
            type: string
          type: object
          title: Checks
      type: object
      required:
        - status
        - checks
      title: ReadinessResponse
      description: Readiness check response schema.
    RefreshTokenRequest:
      properties:
        refresh_token:
          type: string
          title: Refresh Token
      type: object
      required:
        - refresh_token
      title: RefreshTokenRequest
      description: Schema for refreshing access token.
    RegisterRequest:
      properties:
        email:
          type: string
          format: email
          title: Email
        password:
          type: string
          maxLength: 128
          minLength: 12
          title: Password
        full_name:
          type: string
          maxLength: 255
          minLength: 1
          title: Full Name
        tenant_name:
          type: string
          maxLength: 255
          minLength: 1
          title: Tenant Name
      type: object
      required:
        - email
        - password
        - full_name
        - tenant_name
      title: RegisterRequest
      description: "Schema for user registration.


        Creates both a new tenant and user in one request."
    RegisterResponse:
      properties:
        user:
          $ref: "#/components/schemas/UserResponse"
        access_token:
          type: string
          title: Access Token
        refresh_token:
          type: string
          title: Refresh Token
        token_type:
          type: string
          title: Token Type
          default: bearer
        expires_in:
          type: integer
          title: Expires In
      type: object
      required:
        - user
        - access_token
        - refresh_token
        - expires_in
      title: RegisterResponse
      description: Schema for registration response.
    TokenResponse:
      properties:
        access_token:
          type: string
          title: Access Token
        refresh_token:
          type: string
          title: Refresh Token
        token_type:
          type: string
          title: Token Type
          default: bearer
        expires_in:
          type: integer
          title: Expires In
          description: Access token expiration in seconds
      type: object
      required:
        - access_token
        - refresh_token
        - expires_in
      title: TokenResponse
      description: Schema for authentication token response.
    UserListResponse:
      properties:
        items:
          items:
            $ref: "#/components/schemas/UserResponse"
          type: array
          title: Items
        total:
          type: integer
          title: Total
        page:
          type: integer
          title: Page
        page_size:
          type: integer
          title: Page Size
      type: object
      required:
        - items
        - total
        - page
        - page_size
      title: UserListResponse
      description: Schema for listing users.
    UserResponse:
      properties:
        email:
          type: string
          format: email
          title: Email
        full_name:
          type: string
          maxLength: 255
          minLength: 1
          title: Full Name
        id:
          type: string
          format: uuid
          title: Id
        tenant_id:
          type: string
          format: uuid
          title: Tenant Id
        is_active:
          type: boolean
          title: Is Active
        is_superuser:
          type: boolean
          title: Is Superuser
        oauth_provider:
          anyOf:
            - type: string
            - type: "null"
          title: Oauth Provider
        created_at:
          type: string
          format: date-time
          title: Created At
        updated_at:
          type: string
          format: date-time
          title: Updated At
      type: object
      required:
        - email
        - full_name
        - id
        - tenant_id
        - is_active
        - is_superuser
        - created_at
        - updated_at
      title: UserResponse
      description: Schema for user response data.
    UserUpdate:
      properties:
        email:
          anyOf:
            - type: string
              format: email
            - type: "null"
          title: Email
        full_name:
          anyOf:
            - type: string
              maxLength: 255
              minLength: 1
            - type: "null"
          title: Full Name
      type: object
      title: UserUpdate
      description: Schema for updating user data.
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
              - type: string
              - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
        - loc
        - msg
        - type
      title: ValidationError
  securitySchemes:
    HTTPBearer:
      type: http
      scheme: bearer
